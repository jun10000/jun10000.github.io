<div class="embed-iframe-16-9">
    <iframe title="go-wasm player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen srcdoc="
        <!doctype html>
        <html style='height: 100%;'>
        <head>
            <meta charset='utf-8'>
            <title>go-wasm player</title>
            <script src='/gowasm.js'></script>
            <script>
                function FocusWasm() {
                    let eCanvases = document.body.getElementsByTagName('canvas');
                    if (eCanvases.length > 0) {
                        eCanvases[0].focus();
                    }
                }

                function ToggleFullscreen() {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen();
                    } else {
                        document.exitFullscreen();
                    }

                    FocusWasm();
                }

                async function RunGoWasm() {
                    const eStarter = document.getElementById('starter');
                    const eStarterButton = document.getElementById('starterButton');
                    const eStarterLoading = document.getElementById('starterLoading');
                    const eStarterLoadingPercentage = document.getElementById('starterLoadingPercentage');
                    const eStarterLoadingBytes = document.getElementById('starterLoadingBytes');
                    const eStarterOtherStatus = document.getElementById('starterOtherStatus');
        
                    // Change view
                    eStarter.removeAttribute('onclick');
                    eStarterButton.hidden = true;
                    eStarterLoading.hidden = false;
        
                    const go = new Go();
                    const fetchResponse = await fetch('{{ .Inner }}');
                    const fetchResponseCLHeader = fetchResponse.headers.get('content-length');
                    const fetchResponseReader = fetchResponse.body.getReader();
                    const dataByteLength = fetchResponseCLHeader ? parseInt(fetchResponseCLHeader, 10) : 0;
                    const dataChunks = [];
                    let dataByteLoaded = 0;
        
                    // Download data
                    while (true) {
                        const { done, value } = await fetchResponseReader.read();
                        if (done) {
                            break;
                        }
        
                        dataChunks.push(value);
                        dataByteLoaded += value.byteLength;
                        if (dataByteLength) {
                            let p = Math.floor(dataByteLoaded / dataByteLength * 100);
                            let lcur = Math.floor(dataByteLoaded / 1024 / 1024);
                            let lmax = Math.floor(dataByteLength / 1024 / 1024);
                            eStarterLoadingPercentage.innerText = `${p}%`;
                            eStarterLoadingBytes.innerText = `${lcur} / ${lmax} MiB`;
                        } else {
                            let lcur = Math.floor(dataByteLoaded / 1024 / 1024);
                            eStarterLoadingBytes.innerText = `${lcur} MiB`;
                        }
                    }
        
                    // Change view
                    eStarterLoading.hidden = true;
                    eStarterOtherStatus.hidden = false;
        
                    // Convert data to wasm data
                    let wasmData = new Uint8Array(dataByteLoaded);
                    let wasmIndex = 0;
                    for (let c of dataChunks) {
                        wasmData.set(c, wasmIndex);
                        wasmIndex += c.byteLength;
                    }
        
                    // Create wasm instance
                    const wasmInstance = await WebAssembly.instantiate(wasmData.buffer, go.importObject);
        
                    // Change view
                    eStarter.remove();

                    // Start wasm instance
                    go.run(wasmInstance.instance);
                    FocusWasm();
                }
            </script>
        </head>
        <body style='color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); height: 100%; margin: 0px; padding: 0px; position: relative;'>
            <div id='starter' style='display: flex; height: 100%; justify-content: center; align-items: center; background-size: cover; background-image: url(&quot;/gowasm-bg.jpg&quot;);' onClick='RunGoWasm();'>
                <img id='starterButton' src='/play.png'>
                <table id='starterLoading' hidden>
                    <tr>
                        <td>ダウンロード中...</td>
                        <td id='starterLoadingPercentage' style='text-align: right; width: 3rem;'>0%</td>
                    </tr>
                    <tr>
                        <td id='starterLoadingBytes' colspan='2' style='text-align: right;'>0 / 0 MiB</td>
                    </tr>
                </table>
                <span id='starterOtherStatus' hidden>もうすぐ始まります...</span>
            </div>
            <img style='position: absolute; inset: auto 1rem 1rem auto; opacity: 0.8;' src='/fullscreen.png' onClick='ToggleFullscreen();'></img>
        </body>
        </html>
    "></iframe>
</div>